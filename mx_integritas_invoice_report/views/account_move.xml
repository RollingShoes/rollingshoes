<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="account_move_modify_top_report" model="ir.ui.view">
        <field name="name">Report Integritas Modify Top</field>
        <field name="type">qweb</field>
        <field name="inherit_id" ref="account.report_invoice_document"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@id='informations']" position="replace">
				<t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()"/>
				<t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)"/>
			    
			    <t t-set="external" t-value="o.l10n_mx_edi_get_et_etree(xml)"/>
				<div id="informations">
				    <table class=" mb32" style="width:100%;font-size:.8rem!important">
				    	<tr style="width:100%">
				    		<td style="width:50%">
							    <div class="mt32 mb32" style="width:100%" t-if="o.invoice_date" >
							    	<div t-if="o.company_id.vat">
							    		<strong>RFC Emisor:</strong> <span t-field="o.company_id.vat"/><br/>
							    	</div>
							        <div t-if="o.company_id.name">
							        	<strong>Nombre Emisor:</strong> <span t-field="o.company_id.name"/><br/>
							        </div>
							        <div t-if="o.company_id.street">
							        	<strong>Domicilio Fiscal:</strong> <span t-field="o.company_id.street"/><br/>
							        </div>
							        <div t-if="xml">
							        	<strong>Folio:</strong> <span t-esc="xml.get('Folio')"/><br/>
							        </div>
							        <div t-if="o.partner_id.vat">
							        	<strong>RFC receptor:</strong> <span t-field="o.partner_id.vat"/><br/>
							        </div>
							        <div t-if="o.partner_id.name">
							        	<strong>Nombre receptor:</strong> <span t-field="o.partner_id.name"/><br/>
							        </div>
							        <div t-if="o.partner_id.street">
						        	 	<strong>Domicilio fiscal:</strong> <span t-field="o.partner_id.street"/><br/>
							        </div>
							        <div t-if="o.l10n_mx_edi_usage">
							        	<strong>Uso CFDI:</strong> <span t-field="o.l10n_mx_edi_usage"/><br/>
							        </div>
							    </div>
						    </td>
						    <td style="width:50%">
							    <div class="mt32 mb32" style="width:100%" t-if="o.invoice_date" >
							    	<div t-if="o.l10n_mx_edi_cfdi_uuid">
							    		<strong>Folio Fiscal:</strong> <span t-field="o.l10n_mx_edi_cfdi_uuid"/><br/>
							    	</div>
							    	<div t-if="xml">
							    		<strong>No. de serie del CSD</strong> <span t-esc="xml.get('NoCertificado')"/><br/>
								        <!--<t t-set="icount" t-value="0"/>
								        <t t-foreach="request.env['res.config.settings'].search([('id', '=', 1)])" t-as="cer">
								        	<t i-if="cer.l10n_mx_edi_certificate_ids[0].serial_number">
								        		<t i-if="icount == 0">
								        			<t t-esc="cer.l10n_mx_edi_certificate_ids[0].serial_number"></t>
								        			<t t-set="icount" t-value="icount + 1"/>
							        			</t>
							        		</t>
								        </t>-->
							    	</div>
							    	<div t-if="xml">
							    		<strong>Código Postal, fecha y hora de la emisión:</strong> <span t-esc="o.partner_id.zip"></span>, <span t-esc="xml.get('fecha', xml.get('Fecha', '')).replace('T', ' ')"/><br/>
							    	</div>
							    	<div t-if="xml">
							    		<strong>Efecto de comprobante:</strong>
								        <t t-if="xml.get('TipoDeComprobante') == 'I'">
											<span t-esc="'Ingreso'"/><br/>
								        </t>
								        <t t-if="xml.get('TipoDeComprobante') == 'E'">
											<span t-esc="'Egreso'"/><br/>
								        </t>
								        <t t-if="xml.get('TipoDeComprobante') == 'T'">
											<span t-esc="'Traslado'"/><br/>
								        </t>
								        <t t-if="xml.get('TipoDeComprobante') == 'P'">
											<span t-esc="'Pago'"/><br/>
								        </t>
								        <t t-if="xml.get('TipoDeComprobante') == 'N'">
											<span t-esc="'Nómina'"/><br/>
								        </t>
							    	</div>
							    	<div t-if="o.partner_id.property_account_position_id.name">
							    		<strong>Regimen Fiscal:</strong> <span t-esc="o.partner_id.property_account_position_id.name"/>
							    	</div>
							    </div>
						    </td>
					    </tr>
				    </table>
				    <h3>Conceptos</h3>
			    </div>
			</xpath>
        </field>
    </record>

    <record id="account_move_modify_bottom_report" model="ir.ui.view">
        <field name="name">Report Integritas Modify Bottom</field>
        <field name="type">qweb</field>
        <field name="inherit_id" ref="account.report_invoice_document"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@id='total']" position="before">
				<t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()"/>
				<t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)"/>
			    
			    <t t-set="external" t-value="o.l10n_mx_edi_get_et_etree(xml)"/>
				<table class="mt32 mb32" style="width:100%;font-size:.8rem!important">
					<tr>
						<td rowspan="2">
						    <div  t-if="o.invoice_date" >
						    	<div t-if="o.currency_id.name">
						    		<strong>Moneda:</strong> <span t-field="o.currency_id.name"/><br/>
						    	</div>
						        <div t-if="xml">
						        	<strong>Forma de pago:</strong> 
							        <t t-if="xml.get('FormaPago') == '01'">
										<span t-esc="'Efectivo'"/><br/>
							        </t>
							        <t t-if="xml.get('FormaPago') == 'E02'">
										<span t-esc="'Cheque nominativo'"/><br/>
							        </t>
							        <t t-if="xml.get('FormaPago') == '03'">
										<span t-esc="'Transferencia electrónica de fondos'"/><br/>
							        </t>
							        <t t-if="xml.get('FormaPago') == '99'">
										<span t-esc="'Por definir'"/><br/>
							        </t>
						        </div>
						        <div t-if="xml">
					        		<strong>Método de pago:</strong> <span t-esc="xml.get('MetodoPago')"/><br/>
						        </div>
						    </div>
					    </td>
					   
					    <td rowspan="1" t-if="o.invoice_date" style="width:48%">
					       
					  		<div>
						     	<t t-set="subtotal" t-value="0"/>
						     	<t t-set="descuento" t-value="0"/>
						     	<t t-set="contador" t-value="0"/>
						     	<t t-foreach="o.invoice_line_ids" t-as="line">
						            <t t-set="subtotal_price_unit" t-value="round((line.quantity * line.price_unit) ,4)"/> 
						         	<t t-set="subtotal" t-value="round(subtotal + subtotal_price_unit,4)"></t>
						         	<t t-set="contador" t-value="contador + 1"></t>
						         	<t t-set="descuento" t-value="(descuento + line.discount)"></t>

						        </t>
						        <table style="width:100%">
						        	<tr t-if="subtotal">
						        		<td>
					        			 	<strong style="font-size:1rem!important">Subtotal: </strong><br/>
						        		</td>
						        		<td ></td>
						        		<td style="text-align:right">
						        			<span  style="font-size:1rem!important">$ <t t-esc="'{0:,.2f}'.format(subtotal)"/></span>
						        		</td>
						        	</tr>
						        	<tr >
						        		<td style="">
					        			 	<strong style="font-size:1rem!important">Descuento: </strong><br/>
						        		</td>
						        		<td style="text-align:right">
						        			<t t-set="percentaje" t-value="(descuento / contador)"/>
					        			 	<span style="font-size:1rem!important"><t t-esc="'-' + str(percentaje) + '%'"></t></span><br/>
						        		</td>
						        		<td style="text-align:right">
						        			<t t-set="discount_price" t-value="((descuento / contador) * subtotal) / 100"/>
						        			<span  style="font-size:1rem!important"><t t-esc="'- $ ' + str('{0:,.2f}'.format(discount_price))"></t></span><br/>
						        		</td>
						        	</tr>
						        </table>
						       	
						        
						        <!--<strong>Subtotal: </strong><t t-esc="subtotal"></t><br/>
						        <strong>Descuento: </strong><t t-esc="'-' + str((descuento / contador)) + '%'"></t><br/>
						        <strong>Subtotal: </strong><t t-esc="o.amount_untaxed"></t><br/>
						      	<strong>Impuestos Trasladados: </strong>
						      	<table>
							      	<t t-foreach="o.amount_by_group" t-as="amount_by_group">
							            <tr style="">
							                <t t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) in [0, 1] and o.amount_untaxed == amount_by_group[2]">
							                    <td><span class="text-nowrap" t-esc="amount_by_group[0]"/></td>
							                    <td class="text-right o_price_total">
							                        <span class="text-nowrap" t-esc="amount_by_group[3]"/>
							                    </td>
							                    
							                </t>
							                <t t-else="">
							                    <td>
							                        <span t-esc="amount_by_group[0]"/>
							                        <span class="text-nowrap"> on
							                            <t t-esc="amount_by_group[4]"/>
							                        </span>
							                    </td>
							                    <td class="text-right o_price_total">
							                        <span class="text-nowrap" t-esc="amount_by_group[3]"/>
							                    </td>
							                </t>
							            </tr>
							        </t>
						        </table>
						        <br/>
						        <strong>Total: </strong><span class="text-nowrap" t-field="o.amount_total"/><br/>-->
					        </div>
			          	</td>
			          </tr>
				</table>
			</xpath>
        </field>
    </record>

     <record id="account_move_modify_remove_top_report" model="ir.ui.view">
        <field name="name">Report Integritas Modify Remove Top</field>
        <field name="type">qweb</field>
        <field name="inherit_id" ref="account.report_invoice_document"/>
        <field name="arch" type="xml">
           <xpath expr="//t[@t-set='address']" position="replace">
				<span></span>
			</xpath>
        </field>
    </record>

</odoo>